# 重绘和回流

## 重绘

### 概念

重绘（repaint）：如果元素的样式改变不影响它在文档流中的位置时（如 color, background-color, visibility 等），浏览器会将新样式赋予给元素，并重新渲染它。这个过程称为重绘。

### 时机

会引发重绘的因素：

* 元素的颜色，透明度改变的时候。
* text-align 改变等

## 回流

### 概念

回流（reflow）：又称重排，当[[渲染树]]中部分元素或全部元素的尺寸、结构、或某些属性发生改变时，浏览器重新渲染部分或全部文档的过程称为回流。

### 时机

会触发回流的因素：

1. 添加或删除可见的 DOM 元素；
2. 元素的位置发生改变；
3. 元素的尺寸发生改变；
4. 内容发生变化，比如文本变化或者图片被另一个不同尺寸的图片替代；
5. 浏览器的窗口尺寸变化（因为回流是根据视口的大小计算元素的位置和大小的；

## 浏览器优化机制

由于每次回流都会造成额外的计算损耗，因此大多数浏览器都会通过队列化修改并批量执行来优化重排过程。浏览器会将修改操作放入到队列里，直到过了一段时间或者操作达到了一个阈值，才清空队列。

但是，当用户获取布局信息的操作的时候（如下），会强制清空队列：

* offsetTop, offsetLeft, offsetWidth, offsetHeight
* scrollTop, scrollLeft, scrollWidth, scrollHeight
* clientTop, clientLeft, clientWidth, clientHeight
* getComputedStyle()

因为读取布局信息的时候，必须保证返回给用户的是最新最准确的布局信息。

## 关系

回流一定会触发重绘，重绘不一定会触发回流。
