# 普通函数

## 简介

在 ECMAScript 规范里，**普通函数对象**在创建的时候会带有两个内部方法：

* `[[Call]]` —— 支持函数调用 `f()`。
* `[[Construct]]` —— 支持构造调用 `new f()`。

而**箭头函数**只有 `[[Call]]`，没有 `[[Construct]]`。

## 普通函数的 `[[Construct]]` 的抽象算法（规范版）

在 [ECMAScript § 9.2.2 FunctionCreate / § 9.2.3 MakeConstructor / § 9.2.6 OrdinaryFunctionCreate] 等章节里定义。
当你执行 `new F(...args)` 时，规范里的 `[[Construct]]` 会触发 **`OrdinaryConstruct`** 算法，流程大概是：

**OrdinaryConstruct(F, argumentsList, newTarget):**

1. 创建一个新对象 `obj`，其 `[[Prototype]]` 设置为 `newTarget.prototype`（如果不是对象，就退回默认的 `%Object.prototype%`）。
2. 调用函数体（执行 `F.[[Call]]`），并把 `this` 绑定到 `obj`。
3. 如果执行结果返回一个对象，则返回那个对象。
4. 否则，返回步骤 1 中创建的 `obj`。

## 伪代码表示

```js
function [[Construct]](F, args, newTarget) {
  // 1. 创建新对象并设置原型
  let obj = OrdinaryCreateFromConstructor(newTarget, "%Object.prototype%");
  
  // 2. 调用函数体，把 this 绑定到新对象
  let result = F.[[Call]](obj, args);
  
  // 3. 如果返回的是对象，就用它替换新对象
  if (Type(result) === "Object") {
    return result;
  }
  
  // 4. 否则返回新建的对象
  return obj;
}
```
